import{Da as f,b as u,f as c,g as d,j as i,o as l,q as b,r as s,wa as m}from"./chunk-AFT7IMM4.js";var k=new b("JWT_OPTIONS"),g=(()=>{class o{constructor(e=null){this.tokenGetter=e&&e.tokenGetter||function(){}}urlBase64Decode(e){let r=e.replace(/-/g,"+").replace(/_/g,"/");switch(r.length%4){case 0:break;case 2:{r+="==";break}case 3:{r+="=";break}default:throw new Error("Illegal base64url string!")}return this.b64DecodeUnicode(r)}b64decode(e){let r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="";if(e=String(e).replace(/=+$/,""),e.length%4===1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let p=0,h,a,E=0;a=e.charAt(E++);~a&&(h=p%4?h*64+a:a,p++%4)?n+=String.fromCharCode(255&h>>(-2*p&6)):0)a=r.indexOf(a);return n}b64DecodeUnicode(e){return decodeURIComponent(Array.prototype.map.call(this.b64decode(e),r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join(""))}decodeToken(e=this.tokenGetter()){return e instanceof Promise?e.then(r=>this._decodeToken(r)):this._decodeToken(e)}_decodeToken(e){if(!e||e==="")return null;let r=e.split(".");if(r.length!==3)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");let n=this.urlBase64Decode(r[1]);if(!n)throw new Error("Cannot decode the token.");return JSON.parse(n)}getTokenExpirationDate(e=this.tokenGetter()){return e instanceof Promise?e.then(r=>this._getTokenExpirationDate(r)):this._getTokenExpirationDate(e)}_getTokenExpirationDate(e){let r;if(r=this.decodeToken(e),!r||!r.hasOwnProperty("exp"))return null;let n=new Date(0);return n.setUTCSeconds(r.exp),n}isTokenExpired(e=this.tokenGetter(),r){return e instanceof Promise?e.then(n=>this._isTokenExpired(n,r)):this._isTokenExpired(e,r)}_isTokenExpired(e,r){if(!e||e==="")return!0;let n=this.getTokenExpirationDate(e);return r=r||0,n===null?!1:!(n.valueOf()>new Date().valueOf()+r*1e3)}getAuthScheme(e,r){return typeof e=="function"?e(r):e}}return o.\u0275fac=function(e){return new(e||o)(s(k))},o.\u0275prov=l({token:o,factory:o.\u0275fac}),o})();var y=class o{constructor(t,e,r){this.httpClient=t;this.router=e;this.jwtHelper=r;let n=localStorage.getItem(this.TOKEN_KEY);this.userSubject=new u(n),this.userToken=this.userSubject.asObservable()}userSubject;userToken;TOKEN_KEY="token";baseUrl="http://localhost:5223/api";login(t){let e=`${this.baseUrl}/Auth/login`;return this.httpClient.post(e,t,{responseType:"text"}).pipe(d(r=>(this.setToken(r),console.log("new token",r),r)),i(this.handleError))}getUnregisteredBanks(){let t=`${this.baseUrl}/SuperAdmin/UnregisteredBanks`;return this.httpClient.get(t).pipe(i(this.handleError))}getUnregisteredCorporate(){let t=`${this.baseUrl}/SuperAdmin/UnregisteredCorporate`;return this.httpClient.get(t).pipe(i(this.handleError))}getBanks(){let t=`${this.baseUrl}/SuperAdmin/Banks`;return this.httpClient.get(t).pipe(i(this.handleError))}getCorporates(){let t=`${this.baseUrl}/SuperAdmin/Corporates`;return this.httpClient.get(t).pipe(i(this.handleError))}getPaymentRequests(){let t=`${this.baseUrl}/SuperAdmin/Corporate/Employees`;return this.httpClient.get(t).pipe(i(this.handleError))}approvePayment(t){let e=`${this.baseUrl}/SuperAdmin/Corporate/ApproveEmployees`;return this.httpClient.put(e,t).pipe(i(this.handleError))}addCorporate(t){let e=`${this.baseUrl}/Auth/RegisterCorporate`;return this.httpClient.post(e,t).pipe(d(r=>r&&Object.keys(r).length>0?r:"Success, but no data returned"),i(this.handleError))}addBank(t){let e=`${this.baseUrl}/Auth/RegisterBank`;return this.httpClient.post(e,t).pipe(i(this.handleError))}approveBank(t,e){let r=`${this.baseUrl}/SuperAdmin/ApproveBank/${t}`;return this.httpClient.put(r,e).pipe(i(this.handleError))}approveCorporate(t,e){let r=`${this.baseUrl}/SuperAdmin/ApproveCorporate/${t}`;return this.httpClient.put(r,e).pipe(i(this.handleError))}rejectCorporate(t){let e=`${this.baseUrl}/SuperAdmin/RejectCorporate/${t}`;return this.httpClient.delete(e).pipe(i(this.handleError))}uploadEmployeeFile(t,e){let r=`${this.baseUrl}/Client/UploadEmployees/${t}`,n=new FormData;return n.append("file",e),this.httpClient.post(r,n).pipe(i(this.handleError))}getCorporatesById(t){let e=`${this.baseUrl}/Client/GetCorporates/${t}`;return this.httpClient.get(e).pipe(i(this.handleError))}getCorporateEmployeesById(t){let e=`${this.baseUrl}/Client/GetCorporateEmployees/${t}`;return this.httpClient.get(e).pipe(i(this.handleError))}getBankById(t){let e=`${this.baseUrl}/Bank/GetBankById/${t}`;return this.httpClient.get(e).pipe(i(this.handleError))}getbatchpayments(){let t=`${this.baseUrl}/SuperAdmin/PaymentBatch`;return this.httpClient.get(t).pipe(i(this.handleError))}downloadBatchPayment(){let t=`${this.baseUrl}/SuperAdmin/download`;return this.httpClient.get(t,{responseType:"blob"}).pipe(i(this.handleError))}getBeneficiary(t){let e=`${this.baseUrl}/Beneficiary/GetBeneficiaryWithCorpId/${t}`;return this.httpClient.get(e).pipe(i(this.handleError))}addBenificiary(t,e){let r=`${this.baseUrl}/Beneficiary/AddBeneficiary/${e}`;return this.httpClient.post(r,t).pipe(i(this.handleError))}getBenficiaryRequests(){let t=`${this.baseUrl}/Beneficiary`;return this.httpClient.get(t).pipe(i(this.handleError))}approveBenificiary(t){let e=`${this.baseUrl}/SuperAdmin/ApproveBeneficiary/${t}`;return this.httpClient.put(e,t).pipe(i(this.handleError))}rejectBenificiary(t){let e=`${this.baseUrl}/SuperAdmin/RejectBeneficiary/${t}`;return this.httpClient.put(e,t).pipe(i(this.handleError))}getBenificiaryById(t){let e=`${this.baseUrl}/Beneficiary/GetBeneficiaryByBenificiaryId/${t}`;return this.httpClient.get(e).pipe(i(this.handleError))}benificiaryPayment(t,e){let r=`${this.baseUrl}/Beneficiary/PaymentDone`,n={Id:t,Amount:e};return this.httpClient.post(r,n).pipe(i(this.handleError))}getEmployeeReport(){let t=`${this.baseUrl}/SuperAdmin/status-report`;return this.httpClient.get(t).pipe(i(this.handleError))}updateCorporate(t){let e=`${this.baseUrl}/SuperAdmin/UpdateCorporateData/${t.CorporateId}`;return this.httpClient.put(e,t).pipe(i(this.handleError))}setToken(t){t?(localStorage.setItem(this.TOKEN_KEY,t),this.userSubject.next(t)):this.clearToken()}clearToken(){localStorage.removeItem(this.TOKEN_KEY),this.userSubject.next(null)}getUserRoles(){let t=this.userSubject.getValue();if(!t||this.jwtHelper.isTokenExpired(t))return[];let e=this.decodeRoles(t);return e&&e.length>0?e:[]}isAuthenticated(){let t=localStorage.getItem("token");return t!==null&&!this.jwtHelper.isTokenExpired(t)}decodeRoles(t){if(t)try{let e=this.jwtHelper.decodeToken(t);if(e.role)return[e.role];if(e.roles)return e.roles}catch(e){console.error("Error decoding token:",e)}return[]}isValidToken(t){if(t)try{return!this.jwtHelper.isTokenExpired(t)}catch(e){return console.error("Error checking token expiration:",e),!1}return!1}logout(){this.clearToken(),this.router.navigate(["/login"])}handleError(t){let e="";return t.error instanceof ErrorEvent?e=`Error :${t.error.message}`:e=`Status :${t.status}`,c(e)}static \u0275fac=function(e){return new(e||o)(s(m),s(f),s(g))};static \u0275prov=l({token:o,factory:o.\u0275fac,providedIn:"root"})};export{k as a,g as b,y as c};
